{% macro form_entry(field, description=True) %}
<div class="form-entry">
  <div>{{ field.label(class='error' if field.errors else '') }} {% if field.flags.required %}<span class="required">*</span>{% endif %}</div>
  {% for error in field.errors %}
  <div class="field-description error">
    {{ _("Fel:") }} {{ error }}
  </div>
  {% endfor %}
  {% if description and field.description %}
  <div class="field-description">
    {{ field.description }}
  </div>
  {% endif %}
  <div class="form-field">
    <span>{{ field(*varargs, **kwargs) }}</span>
  </div>
</div>
{% endmacro %}

{% macro form_entry_row(field, description=True) %}
<div class="form-entry">
  <span class="form-field">
    <span>{{ field(*varargs, **kwargs) }}</span>
  </span>
  <span>{{ field.label }} {% if field.flags.required %}<span class="required">*</span>{% endif %}</span>
  {% if description and field.description %}
  <div class="field-description">
    {{ field.description }}
  </div>
  {% endif %}
  {% for error in field.errors %}
  <div class="field-error">
    {{ error }}
  </div>
  {% endfor %}
</div>
{% endmacro %}

{% macro profile_picture(user, with_link=False) %}
{% if user.profile_picture %}
{% if with_link %}
<a class="profile-picture" href="{{ url_for_image(user.profile_picture.filename, 'profilepicture') }}">
  <img src="{{ url_for_image(user.profile_picture.filename, 'profilepicture', 600) }}">
</a>
{% else %}
<img class="profile-picture" src="{{ url_for_image(user.profile_picture.filename, 'profilepicture', 200) }}">
{% endif %}
{% else %}
<div class="profile-picture">
  <div class="no-profile-picture">
    {{ user.emoji }}
  </div>
</div>
{% endif %}
{% endmacro %}

{% macro usercard(user, articles) %}
<div class="card usercard">
  <div class="picture-and-name">
    <a href="{{ url_for('strequelistan.show_profile', user_id=user.id) }}">
      {{ profile_picture(user) }}
      <div class="username" data-firstname="{{ user.first_name }}"
                            data-lastname="{{ user.last_name }}"
                            data-nickname="{{ user.nickname or '' }}"
                            data-phonenumber="{{ user.formatted_phone(e164=True) }}">
        {% if user.nickname %}
        {{ user.nickname }}
        {% else %}
        {{ user.first_name }} {{ user.last_name }}
        {% endif %}
      </div>
    </a>
    {% if user.bac >= 0.1 %}
    {% set bac = user.bac %}
    <div class="alcometer">
      {% if bac < 0.3 %}
      🍺
      {% elif bac < 0.5 %}
      🍻
      {% elif bac < 1 %}
      👌
      {% elif bac < 1.5 %}
      🕺
      {% elif bac < 2 %}
      😟
      {% elif bac < 2.5 %}
      🤢
      {% elif bac < 3 %}
      😵
      {% elif bac < 3.5 %}
      💀
      {% elif bac < 4 %}
      🇷🇺
      {% else %}
      🇫🇮
      {% endif %}
      <span class="bac">
        {{ '{:.2f}'.format(bac) }}
      </span>
    </div>
    {% endif %}
  </div>
  <form class="streque-form streque-buttons" method="POST">
    {# CSRF token is cached during the request, all calls to csrf_token() will
    return the same one #}
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    {% for article in articles %}
    <button class="streque-button"
            type="submit"
            formaction="{{ url_for('strequelistan.add_streque', user_id=user.id, article_id=article.id) }}"
            data-userid="{{ user.id }}"
            data-articleid="{{ article.id }}">
      {{ article.name }}
    </button>
    {% endfor %}
  </form>
</div>
{% endmacro %}
